function setInfoBox(e,t){google.maps.event.addListener(arrMarkers[e-1],"click",function(e){infoBoxIndex=arrInfoBoxContent[t-1];infoBox.open(map,this);infoBox.setContent(infoBoxIndex)})}function sortArray(e,t){e=e.split(".");var n=e.length;t.sort(function(t,r){var i=0;while(i<n){x=t[e[i]];y=r[e[i]];i++}if(x<y){return-1}else if(x>y){return 1}else{if(t.data.title<r.data.title){return-1}else if(t.data.title>r.data.title){return 1}else{return 0}}});return t}function filterMarkers(e){for(i=0;i<arrMarkers.length;i++){var t=arrMarkers[i].get("category");var n=false;for(x=0;x<e.length;x++){if(t==e[x]){n=true}}if(n){arrMarkers[i].setVisible(true)}else{arrMarkers[i].setVisible(false);if(infoBoxIndex=i){infoBox.close()}}}}function arrangeByType(e){arrData=sortArray("type",arrData);var t="";var n="";var r="";for(i=0;i<arrData.length;i++){var s=arrData[i].type;var o=false;for(x=0;x<e.length;x++){if(s==e[x]){o=true}}if(o){if(arrData[i].type!=t){if(t!=""){r+="</ul>"}t=arrData[i].type;if(t=="park"){n="Parks"}else if(t=="centre"){n="Natural resources centres"}else if(t=="office"){n="Natural resources offices"}else if(t=="community"){n="Community-run centres"}else{n=t}r+="<h2>"+n+"</h2><ul>"}if(arrData[i].type=="centre"||arrData[i].type=="office"||arrData[i].type=="community"){r+="<li><strong>"+arrData[i].data.title+"</strong><br />"+arrData[i].data.info+"</li>"}else if(arrData[i].type=="park"){r+="<li><a hre"+'f="'+arrData[i].data.link+'" target="_blank">'+arrData[i].data.title+"</a></div>"}else{r+="<li><strong><a hre"+'f="'+arrData[i].data.link+'">'+arrData[i].data.title+"</a></strong></li>"}}}if(t!=""){r+="</ul>"}else{r="<p>No results found.</p>"}$("#map-list").html(r)}function arrangeByName(e){arrData=sortArray("data.title",arrData);var t="";var n="";var r="";var s="";var o="";for(i=0;i<arrData.length;i++){var u=arrData[i].type;var a=false;for(x=0;x<e.length;x++){if(u==e[x]){a=true}}if(a){if(arrData[i].data.title.charAt(0)!=t){if(t!=""){o+="</ul>"}t=arrData[i].data.title.charAt(0);n=t.toUpperCase();o+="<h2>"+n+"</h2><ul>"}r=arrData[i].type;if(r=="centre"||r=="office"||r=="community"){if(r=="centre"){s="Natural resources centre"}else if(r=="office"){s="Natural resources office"}else if(r=="community"){s="Community-run centre"}o+="<li><strong>"+arrData[i].data.title+"</strong><br /><em>"+s+"</em><br />"+arrData[i].data.info+"</li>"}else if(arrData[i].type=="park"){o+="<li><a hre"+'f="'+arrData[i].data.link+'" target="_blank">'+arrData[i].data.title+"</a></div>"}else{o+="<li><strong><a hre"+'f="'+arrData[i].data.link+'">'+arrData[i].data.title+"</a></strong><br />"+r+"</li>"}}}if(t!=""){o+="</ul>"}else{o="<p>No results found.</p>"}$("#map-list").html(o)}function applyFilters(e){var t=[];$("#map-filter>ul input:checkbox").each(function(){if($(this).is(":checked")){t.push($(this).val())}});if($("#map-sort>ul input:radio:checked").val()=="type"){arrangeByType(t)}else if($("#map-sort>ul input:radio:checked").val()=="name"){arrangeByName(t)}if(e){filterMarkers(t)}}function setFilters(){arrData=sortArray("type",arrData);var e="";var t="";var n="";for(i=0;i<arrData.length;i++){if(arrData[i].type!=e){e=arrData[i].type;if(e=="park"){t="Parks"}else if(e=="centre"){t="Natural resources centres"}else if(e=="office"){t="Natural resources offices"}else if(e=="community"){t="Community-run centres"}else{t=e}n+='<li><input type="checkbox" name="category" value="'+e+'" checked onclick="applyFilters(true)"> '+t+"</li>"}}$("#map-filter>ul").html(n)}function loadMapData(e,t){$(t).html('<div class="tab"><ul><li><span id="map-filter-toggle">Type</span><div id="map-filter" class="dropdown"><div class="pointer"></div><ul></ul></div></li><li><span id="map-sort-toggle">Sort</span><div id="map-sort" class="dropdown"><div class="pointer"></div><ul><li><input type="radio" name="sort" value="type" checked="" onclick="applyFilters()"> By type</li><li><input type="radio" name="sort" value="name" onclick="applyFilters()"> Alphabetically</li></ul></li></ul></div><div id="map" class="no-mobile"></div><div id="map-list"></div>');mapTarget=document.getElementById("map");map=new google.maps.Map(mapTarget,mapOptions);infoBox=new InfoBox(infoBoxOptions);for(var n=0;n<arrData.length;n++){var r=arrData[n].data.title;var i;if(arrData[n].data.location.latitude!=undefined&&arrData[n].data.location.longitude){i=new google.maps.LatLng(arrData[n].data.location.latitude,arrData[n].data.location.longitude)}else{continue}var s={url:pathToFiles+e+"-marker-general.png",size:new google.maps.Size(49,88),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(12,44),scaledSize:new google.maps.Size(24,44)};if(arrData[n].type=="centre"){s.url=pathToFiles+e+"-marker-centre.png"}else if(arrData[n].type=="office"){s.url=pathToFiles+e+"-marker-office.png"}else if(arrData[n].type=="community"){s.url=pathToFiles+e+"-marker-community.png"}else if(arrData[n].type=="park"){s.url=pathToFiles+e+"-marker-park.png"}else if(arrData[n].type=="Climate change"){s.url="/files/templates/00000000-0000-0000-0000-000000000000/f88a7f3c-df7e-430a-825c-24cfa8dec9a8/regional-marker-climate-change.png"}else if(arrData[n].type=="Coast and marine"){s.url="/files/templates/00000000-0000-0000-0000-000000000000/f88a7f3c-df7e-430a-825c-24cfa8dec9a8/regional-marker-coast-marine.png"}else if(arrData[n].type=="Community"){s.url="/files/templates/00000000-0000-0000-0000-000000000000/f88a7f3c-df7e-430a-825c-24cfa8dec9a8/regional-marker-community.png"}else if(arrData[n].type=="Land"){s.url="/files/templates/00000000-0000-0000-0000-000000000000/f88a7f3c-df7e-430a-825c-24cfa8dec9a8/regional-marker-land.png"}else if(arrData[n].type=="Native species"){s.url="/files/templates/00000000-0000-0000-0000-000000000000/f88a7f3c-df7e-430a-825c-24cfa8dec9a8/regional-marker-native-species.png"}else if(arrData[n].type=="Water"){s.url="/files/templates/00000000-0000-0000-0000-000000000000/f88a7f3c-df7e-430a-825c-24cfa8dec9a8/regional-marker-water.png"}else if(arrData[n].type=="Wetlands and floodplains"){s.url="/files/templates/00000000-0000-0000-0000-000000000000/f88a7f3c-df7e-430a-825c-24cfa8dec9a8/regional-marker-wetlands-floodplains.png"}arrMarkers.push(new google.maps.Marker({title:r,position:i,map:map,icon:s,category:arrData[n].type}));bounds.extend(i);infoBoxContent=document.createElement("div");infoBoxContent.className="wrapper";if(arrData[n].type=="centre"||arrData[n].type=="office"||arrData[n].type=="community"){infoBoxContent.innerHTML='<div class="pointer"></div><div class="panel">'+arrData[n].data.title+"<br />"+arrData[n].data.info+"</div>"}else if(arrData[n].type=="park"){infoBoxContent.innerHTML='<div class="pointer"></div><div class="panel"><a href="'+arrData[n].data.link+'" target="_blank">'+arrData[n].data.title+"</a></div>"}else{if(arrData[n].data.link!==undefined){infoBoxContent.innerHTML='<div class="pointer"></div><div class="panel"><a href="'+arrData[n].data.link+'">'+arrData[n].data.title+"</a></div>"}else{infoBoxContent.innerHTML='<div class="pointer"></div><div class="panel">'+arrData[n].data.title+"</div>"}}arrInfoBoxContent.push(infoBoxContent);setInfoBox(arrMarkers.length,arrInfoBoxContent.length)}google.maps.event.addListenerOnce(map,"zoom_changed",function(){if(map.getZoom()>12){map.setZoom(12)}});map.fitBounds(bounds);setFilters();applyFilters();if($("html").hasClass("touch")){$("#map-container .tab .dropdown").each(function(){var e=$(this).attr("id");setMenuToggle("#"+e,"#"+e+"-toggle",true)})}}function checkArray(e){for(var t=e.length-1;t>=0;t--){if(!("data"in e[t])||!("type"in e[t])){e.splice(t,1)}}return e}function initialiseMap(e,t){t=encodeURIComponent(t);var n={lines:11,length:0,width:12,radius:24,corners:1,rotate:0,direction:1,color:brandColour,speed:1,trail:60,shadow:false,hwaccel:false,className:"spinner",zIndex:2e9,top:"auto",left:"auto"};$(e).prepend('<div id="spinner-container" style="min-height:10em"></div>');var r=document.getElementById("spinner-container");var i=(new Spinner(n)).spin(r);$.getJSON("/feed.rss?listname="+t,function(t){arrData=checkArray(t);loadMapData(regionName,e)}).always(function(){i.stop()}).fail(function(){$("#spinner-container").remove();$(e+">.no-js").removeClass("no-js")})}var mapTarget;var bounds=new google.maps.LatLngBounds;var mapOptions;var map;var arrMarkers=[];var infoBoxOptions;var infoBox;var infoBoxIndex;var infoBoxContent;var arrInfoBoxContent=[];var arrData=[];var regionName,brandColour,pathToFiles;mapOptions={mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]};infoBoxOptions={disableAutoPan:false,maxWidth:0,pixelOffset:new google.maps.Size(-120,-44),alignBottom:true,zIndex:null,boxClass:"infobox",boxStyle:{width:"240px"},closeBoxMargin:"10px 2px 2px 2px",closeBoxURL:"http://www.google.com/intl/en_us/mapfiles/close.gif",infoBoxClearance:new google.maps.Size(1,1),isHidden:false,pane:"floatPane",enableEventPropagation:false};
